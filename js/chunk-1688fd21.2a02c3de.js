(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1688fd21"],{1835:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"currency-ops-new"},[n("div",{staticStyle:{padding:"10px"}},[n("p",{on:{click:e.checkMigrateContractSaiBalance}},[n("b",[e._v(" "+e._s(e.$t("dappsMaker.current-sai-balance",{value:e.migrateContractBalance})))])]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.noSaiAvailable&&!e.needsAtLeast20,expression:"noSaiAvailable && !needsAtLeast20"}]},[e._v(" "+e._s(e.$t("dappsMaker.not-enough-sai"))+" ")]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.needsAtLeast20,expression:"needsAtLeast20"}],staticStyle:{padding:"10px"}},[e._v(" "+e._s(e.$t("dappsMaker.needs-at-least-20",{value:e.migrateContractBalance}))+" ")])]),n("div",{staticClass:"currency-picker-container"},[n("div",{staticClass:"interface__block-title"},[e._v(" "+e._s(e.$t("dappsMaker.migrate-single-collateral-to-multi-collateral"))+" ")]),n("h4",{directives:[{name:"show",rawName:"v-show",value:!e.cdpDetailsLoaded,expression:"!cdpDetailsLoaded"}]},[e._v(" "+e._s(e.$t("dappsMaker.loading-your-cdps"))+" ")]),e._l(e.cdps,(function(t){return n("div",{key:t},[n("div",{class:["dropdown-text-container","dropdown-container","no-point",t===e.selectedCdp?"selectedCDP":""],on:{click:function(n){return e.selectCDP(t)}}},[n("p",[n("span",{staticClass:"cc DAI cc-icon cc-icon-dai currency-symbol"}),e._v(" "+e._s(t)+" "),n("span",{staticClass:"subname"},[e._v("- CDP ")])])])])})),n("div",{directives:[{name:"show",rawName:"v-show",value:e.noCdpsToMigrateFound,expression:"noCdpsToMigrateFound"}]},[e._v(" "+e._s(e.$t("dappsMaker.no-cdps-to-migrate-found"))+" ")]),n("div",{staticClass:"buttons-container"},[n("div",{class:[e.validInputs?"":"disabled","submit-button large-round-button-green-filled"],on:{click:e.beginMigration}},[e._v(" "+e._s(e.$t("dappsMaker.migrate"))+" ")])])],2),n("div")])])},a=[],s=(n("a4d3"),n("99af"),n("4de4"),n("b680"),n("e439"),n("dbb4"),n("b64b"),n("d3b7"),n("25f0"),n("3ca3"),n("159b"),n("ddb0"),n("96cf"),n("fc11")),i=n("2f62"),c=n("901e"),o=n.n(c),u=n("d1fb"),d=n("70c1"),l=n.n(d),p=n("ce96");function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(n,!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v=function(e){return new o.a(e)},m={props:{ethPrice:{type:o.a,default:function(){return new o.a(0)}},makerActive:{type:Boolean,default:!1},availableCdps:{type:Object,default:function(){return{}}},getCdp:{type:Function,default:function(){}},getValueOrFunction:{type:Function,default:function(){}}},data:function(){return{cdps:[],daiGenerated:0,migrateContractBalance:0,selectedCdp:0,proxyAddress:"",cdpBalances:{},migrationNotPossible:!1,cdpDetailsLoaded:!1,noSaiAvailable:!1,needsAtLeast20:!1}},computed:g({},Object(i["b"])(["account","gasPrice","web3","network","ens"]),{migrationPossible:function(){return v(this.daiGenerated).lt(v(this.migrateContractBalance))&&this.cdpDetailsLoaded&&v(this.daiGenerated).gte(20)},validInputs:function(){return 0!==this.selectedCdp&&this.migrationPossible},noCdpsToMigrateFound:function(){return 0===this.cdps.length&&this.cdpDetailsLoaded}}),watch:{$route:"setup",makerActive:"setup"},mounted:function(){return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:this.setup();case 1:case"end":return e.stop()}}),null,this)},methods:{setup:function(){var e=this;this.makerActive&&(this.migrateContractBalance=0,this.maker=this.getValueOrFunction("maker"),this._mcdManager=this.getValueOrFunction("_mcdManager"),this.getProxy=this.getValueOrFunction("getProxy"),this.proxyAllowances=this.getValueOrFunction("proxyAllowances"),this.proxyAddress=this.getValueOrFunction("proxyAddress"),this.findCdps(),this.getMigrationContractBalance().then((function(t){return e.migrateContractBalance=t})),this.checkMigrateContractSaiBalance())},findCdps:function(){var e,t,n;return regeneratorRuntime.async((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,regeneratorRuntime.awrap(Object(u["y"])(this,this.getValueOrFunction("_cdpService")));case 2:e=r.sent,t=e.withProxy,n=e.withoutProxy,this.cdpDetailsLoaded=!0,this.cdps=t.concat(n);case 7:case"end":return r.stop()}}),null,this)},beginMigration:function(){var e,t,n,r,a,s;return regeneratorRuntime.async((function(i){while(1)switch(i.prev=i.next){case 0:if(0===this.selectedCdp){i.next=35;break}return this.proxyAddress=this.getValueOrFunction("proxyAddress"),i.next=4,regeneratorRuntime.awrap(this.getValueOrFunction("_cdpService").getCdp(this.selectedCdp,this.proxyAddress));case 4:return e=i.sent,i.next=7,regeneratorRuntime.awrap(e.getGovernanceFee());case 7:return t=i.sent.toBigNumber(),i.next=10,regeneratorRuntime.awrap(e.getDebtValue());case 10:return n=i.sent.toBigNumber(),this.cdpBalances[this.selectedCdp]={balance:n},i.next=14,regeneratorRuntime.awrap(this.checkMigrateContractSaiBalance(n));case 14:if(r=i.sent,n.lt(20)&&(this.needsAtLeast20=!0),!r){i.next=35;break}return i.next=19,regeneratorRuntime.awrap(this.needsApproval(t));case 19:if(a=i.sent,!a){i.next=27;break}return i.next=23,regeneratorRuntime.awrap(this.approveMkr(t));case 23:s=i.sent,this.web3.eth.sendTransaction(s).catch((function(e){p["e"].responseHandler(e,p["e"].ERROR)})),i.next=35;break;case 27:return i.prev=27,i.next=30,regeneratorRuntime.awrap(this.migrate(this.selectedCdp));case 30:i.next=35;break;case 32:i.prev=32,i.t0=i["catch"](27),p["e"].responseHandler(i.t0,p["e"].ERROR);case 35:case"end":return i.stop()}}),null,this,[[27,32]])},migrate:function(e){var t;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return t=this.maker.service("migration").getMigration("single-to-multi-cdp"),n.next=3,regeneratorRuntime.awrap(t.execute(e));case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),null,this)},needsApproval:function(e){var t,n;return regeneratorRuntime.async((function(r){while(1)switch(r.prev=r.next){case 0:return t=new this.web3.eth.Contract(u["c"],u["h"].MCD_GOV),r.next=3,regeneratorRuntime.awrap(t.methods.allowance(this.account.address,this.proxyAddress).call());case 3:return n=r.sent,r.abrupt("return",n<e);case 5:case"end":return r.stop()}}),null,this)},approveMkr:function(){var e,t;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return e=new this.web3.eth.Contract(u["c"],u["h"].MCD_GOV),n.t0=e.methods,n.t1=this.proxyAddress,n.t2=l.a,n.next=6,regeneratorRuntime.awrap(e.methods.balanceOf(this.account.address).call());case 6:return n.t3=n.sent,n.t4=n.t2.toWei.call(n.t2,n.t3,"ether").toString(),t=n.t0.approve.call(n.t0,n.t1,n.t4).encodeABI(),n.abrupt("return",{from:this.account.address,to:u["h"].MCD_GOV,value:0,data:t});case 10:case"end":return n.stop()}}),null,this)},selectCDP:function(e){var t,n,r;return regeneratorRuntime.async((function(a){while(1)switch(a.prev=a.next){case 0:if(this.selectedCdp=e,!this.cdpBalances[this.selectedCdp]){a.next=7;break}this.checkMigrateContractSaiBalance(this.cdpBalances[this.selectedCdp].balance),v(this.cdpBalances[this.selectedCdp].balance).lt(20)?this.needsAtLeast20=!0:this.needsAtLeast20=!1,this.daiGenerated=this.cdpBalances[this.selectedCdp],a.next=20;break;case 7:return a.next=9,regeneratorRuntime.awrap(this.getValueOrFunction("_cdpService").getCdp(e,this.proxyAddress));case 9:return t=a.sent,a.next=12,regeneratorRuntime.awrap(t.getGovernanceFee());case 12:return n=a.sent.toBigNumber(),a.next=15,regeneratorRuntime.awrap(t.getDebtValue());case 15:r=a.sent.toBigNumber(),this.checkMigrateContractSaiBalance(r),r.lt(20)?this.needsAtLeast20=!0:this.needsAtLeast20=!1,this.daiGenerated=r.toString(),this.cdpBalances[this.selectedCdp]={balance:r,fee:n};case 20:case"end":return a.stop()}}),null,this)},checkMigrateContractSaiBalance:function(){var e,t=arguments;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return e=t.length>0&&void 0!==t[0]?t[0]:0,n.next=3,regeneratorRuntime.awrap(this.getMigrationContractBalance());case 3:if(this.migrateContractBalance=n.sent,!v(this.migrateContractBalance).lt(20)){n.next=7;break}return this.noSaiAvailable=!0,n.abrupt("return",!1);case 7:if(!v(e).lt(v(this.migrateContractBalance))){n.next=9;break}return n.abrupt("return",!0);case 9:return n.abrupt("return",!1);case 10:case"end":return n.stop()}}),null,this)},getMigrationContractBalance:function(){var e;return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(new this.web3.eth.Contract(u["c"],u["h"].SAI).methods.balanceOf(u["h"].MCD_JOIN_SAI).call());case 2:return e=t.sent,t.abrupt("return",l.a.fromWei(e,"ether").toString());case 4:case"end":return t.stop()}}),null,this)},submitTransaction:function(){var e,t;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return window.scrollTo(0,0),n.prev=1,e=l.a.toWei(this.daiGenerated,"ether").toString(),n.next=5,regeneratorRuntime.awrap(Promise.all([this.approve(e),this.migrate(e)]));case 5:t=n.sent,this.web3.mew.sendBatchTransactions(t).catch((function(e){p["e"].responseHandler(e,p["e"].ERROR)})),n.next=12;break;case 9:n.prev=9,n.t0=n["catch"](1),p["e"].responseHandler(n.t0,p["e"].ERROR);case 12:case"end":return n.stop()}}),null,this,[[1,9]])},displayPercentValue:function(e){return o.a.isBigNumber(e)||(e=new o.a(e)),e.times(100).toString()},displayFixedValue:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return o.a.isBigNumber(e)||(e=new o.a(e)),e.toFixed(t).toString()}}},b=m,f=(n("fc259"),n("2877")),w=Object(f["a"])(b,r,a,!1,null,"2655408a",null),x=w.exports;t["default"]=x},c87f:function(e,t,n){},fc259:function(e,t,n){"use strict";var r=n("c87f"),a=n.n(r);a.a}}]);
//# sourceMappingURL=chunk-1688fd21.2a02c3de.js.map